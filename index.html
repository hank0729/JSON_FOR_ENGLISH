<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>JSON 產生器（支援片語 空白 中文格式）</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    .container { max-width: 900px; margin:auto; background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 6px rgba(0,0,0,.1); }
    h1 { text-align:center; color:#333; margin-bottom:16px; }
    p.hint { margin:8px 0 16px; color:#555; line-height:1.6; }
    textarea { width:100%; height:220px; padding:10px; margin-top:6px; border-radius:6px; border:1px solid #ccc; resize:vertical; font-size:16px; font-family:Consolas, monospace; }
    .btn { display:block; width:100%; padding:14px; margin-top:16px; border:none; border-radius:6px; font-size:16px; cursor:pointer; transition:.2s; }
    .btn-primary { background:#28a745; color:#fff; }
    .btn-primary:hover { background:#218838; }
    .btn-secondary { background:#007bff; color:#fff; }
    .btn-secondary:hover { background:#0069d9; }
    .row { display:flex; gap:12px; margin-top:12px; }
    .row .btn { flex:1; }
    .output { margin-top:20px; display:none; }
    pre { background:#f8f9fa; padding:15px; border-radius:6px; overflow-x:auto; white-space:pre-wrap; word-wrap:break-word; border:1px solid #ddd; }
    .small { color:#777; font-size:13px; }
    .badge { display:inline-block; padding:3px 8px; border-radius:999px; background:#eef; color:#224; font-size:12px; margin-left:6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>JSON 產生器 <span class="badge">自動判斷格式</span></h1>

    <label for="inputData"><strong>輸入資料</strong></label>
    <p class="hint">
      你可以直接貼上像這樣的一大串：<br>
      <code>a game of cat and mouse 貓捉老鼠遊戲 a leap of faith 放手一搏 aboard 船上 absolutely 絕對地 …</code><br>
      也支援原本的「每兩行一組」：第一行英文、第二行中文，依序重複。
    </p>

    <textarea id="inputData" placeholder="範例 1（空白分隔）：
a game of cat and mouse 貓捉老鼠遊戲 a leap of faith 放手一搏 aboard 船上 absolutely 絕對地 …

或

範例 2（每兩行一組）：
diagnose
診斷
diagnosis
診斷
investigate
調查"></textarea>

    <button class="btn btn-primary" onclick="generateJSON()">生成 JSON</button>

    <div class="row">
      <button class="btn btn-secondary" onclick="downloadJSON()">下載 JSON</button>
      <button class="btn" onclick="copyJSON()">複製到剪貼簿</button>
      <button class="btn" onclick="clearAll()">清空</button>
    </div>

    <div class="output" id="outputSection">
      <h2>生成的 JSON</h2>
      <pre id="jsonOutput"></pre>
      <p class="small" id="summary"></p>
    </div>
  </div>

  <script>
    function hasCJK(str) {
      return /[^\x00-\x7F]/.test(str);
    }

    function parseLinePairs(input) {
      const lines = input.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      if (lines.length % 2 !== 0) return null;
      const arr = [];
      for (let i = 0; i < lines.length; i += 2) {
        arr.push({ english: lines[i], chinese: lines[i + 1] });
      }
      return arr;
    }

    function parseSpaceSeparated(input) {
      const text = input.replace(/\s+/g, ' ').trim();

      const re = /([A-Za-z][A-Za-z’'`-]*(?: [A-Za-z][A-Za-z’'`-]*)*)\s+([^\x00-\x7F]+)(?=\s+[A-Za-z]|$)/g;

      const arr = [];
      let m;
      while ((m = re.exec(text)) !== null) {
        const english = m[1].trim();
        const chinese = m[2].trim();
        if (english && chinese) arr.push({ english, chinese });
      }
      return arr;
    }

    function autoParse(input) {
      const lineTry = parseLinePairs(input);
      if (lineTry && lineTry.length > 0) {
        return { data: lineTry, mode: 'line-pairs' };
      }
      const spaceTry = parseSpaceSeparated(input);
      if (spaceTry && spaceTry.length > 0) {
        return { data: spaceTry, mode: 'space-pairs' };
      }
      return { data: [], mode: 'unknown' };
    }

    function generateJSON() {
      const input = document.getElementById('inputData').value.trim();
      if (!input) {
        alert('請先貼上資料！');
        return;
      }

      const { data, mode } = autoParse(input);

      if (!data.length) {
        alert('無法解析輸入。請確認格式：\n1) 每兩行一組（英文→中文），或\n2) 片語(英文) + 空白 + 中文，重複出現。');
        return;
      }

      const jsonString = JSON.stringify(data, null, 4);
      document.getElementById('jsonOutput').textContent = jsonString;
      document.getElementById('summary').textContent =
        `共產生 ${data.length} 筆（偵測格式：${mode === 'line-pairs' ? '每兩行一組' : '空白分隔'}）。`;
      document.getElementById('outputSection').style.display = 'block';
    }

    function downloadJSON() {
      const content = document.getElementById('jsonOutput').textContent;
      if (!content) { alert('尚未產生 JSON。'); return; }
      const blob = new Blob([content], { type: 'application/json;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function copyJSON() {
      const content = document.getElementById('jsonOutput').textContent;
      if (!content) { alert('尚未產生 JSON。'); return; }
      navigator.clipboard.writeText(content)
        .then(() => alert('已複製到剪貼簿！'))
        .catch(() => alert('複製失敗，請手動選取複製。'));
    }

    function clearAll() {
      document.getElementById('inputData').value = '';
      document.getElementById('jsonOutput').textContent = '';
      document.getElementById('summary').textContent = '';
      document.getElementById('outputSection').style.display = 'none';
    }
  </script>
</body>
</html>
